<template>
    <div class="slds-p-around_small"
         style="border: 1px solid red;">
        <lightning-dual-listbox name="headers"
                                label="Select Fields to Display"
                                source-label="Available Fields"
                                selected-label="Visible Fields"
                                options={options}
                                value={selectedColumnHeaders}
                                onchange={handleChangeFieldsToDisplay}>
        </lightning-dual-listbox>

        <lightning-button label='Save'
                          onclick={handleColumnHeaderChange}>
        </lightning-button>
    </div>

    <div class="slds-page-header slds-page-header_extension">
        <div class="slds-page-header__row slds-p-bottom_x-small">
            <div class="slds-page-header__col-title">
                <div class="slds-media">
                    <div class="slds-media__figure">
                        <lightning-icon icon-name={iconName}>
                        </lightning-icon>
                    </div>
                    <div class="slds-media__body">
                        <div class="slds-page-header__name">
                            <div class="slds-page-header__name-title">
                                <template if:true={hasCustomTitle}>
                                    <h1 class="slds-lightning-button-menu_extension slds-p-top_xx-small">
                                        {title}
                                    </h1>
                                </template>
                                <template if:false={hasCustomTitle}>
                                    <h1>
                                        <lightning-button-menu alternative-text={CUSTOM_LABELS.geAssistiveShowMenu}
                                                               variant="bare-inverse"
                                                               label={listViewLabel}
                                                               class="slds-lightning-button-menu_extension"
                                                               onselect={handleChange}>
                                            <template for:each={options}
                                                      for:item="option">
                                                <lightning-menu-item key={option.value}
                                                                     value={option.value}
                                                                     label={option.label}>
                                                </lightning-menu-item>
                                            </template>
                                        </lightning-button-menu>
                                    </h1>
                                </template>
                            </div>
                        </div>
                    </div>
                    <slot name="actions"
                          class="slds-no-flex">
                    </slot>
                    <lightning-button-icon icon-name="utility:settings"
                                           slot="actions">
                    </lightning-button-icon>
                    <lightning-button class="slds-m-left_small"
                                      label={CUSTOM_LABELS.commonListView}
                                      onclick={navigateToListView}
                                      slot="actions">
                    </lightning-button>
                </div>
            </div>
        </div>
        <div class="slds-page-header__row">
            <div class="slds-page-header__col-meta">
                <p class="slds-page-header__meta-text slds-p-bottom_medium">
                    {recordCount} {sortedByLabel} {lastUpdatedOn}
                </p>
                <p class="slds-page-header__meta-text">
                    {description}
                </p>
            </div>
        </div>
    </div>

    <template if:true={isLoading}>
        <lightning-spinner alternative-text={CUSTOM_LABELS.geAssistiveSpinner}>
        </lightning-spinner>
        <c-util-stencil column-count="5"
                        row-count="5">
        </c-util-stencil>
    </template>
    <template if:false={isLoading}>
        <lightning-datatable key-field="id"
                             data={records}
                             columns={columns}
                             hide-checkbox-column
                             onrowaction={handleRowAction}
                             sorted-by={sortedBy}
                             sorted-direction={sortedDirection}
                             onsort={handleColumnSorting}>
        </lightning-datatable>
    </template>

    <slot></slot>

    <template if:false={isLoading}>
        <template if:false={hasRecords}>
            <div class="slds-align_absolute-center"
                 style="height:5rem">
                {CUSTOM_LABELS.commonNoItems}
            </div>
        </template>
    </template>

    <template if:true={isShowStandardFooter}>
        <footer class="slds-card__footer slds-m-top_none">
            <template if:true={hasRecords}>
                <a class="slds-card__footer-action"
                   onclick={handleViewMore}>
                    {CUSTOM_LABELS.commonViewMore}
                    <span class="slds-assistive-text">
                        Footer
                    </span>
                </a>
            </template>
        </footer>
    </template>

    <slot name="footer"></slot>
</template>
