<aura:component controller="RD2_EnablementDelegate_CTRL"
    implements="force:appHostable,lightning:hasPageReference,lightning:isUrlAddressable" access="global">

    <aura:attribute name="state" type="Object" description="Contains enablement state attributes" />

    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
    <aura:handler event="force:refreshView" action="{!c.refreshView}" />


    <lightning:layout horizontalAlign="spread" multipleRows="true" class="slds-hide" aura:id="enablement-disabled">
        <lightning:layoutItem padding="horizontal-large" size="10">
            <div class="slds-illustration slds-illustration_large">
                <br /><br />
                <img src="/img/chatter/OpenRoad.svg" class="slds-illustration__svg" alt="OpenRoad" />
                <div class="slds-text-longform">
                    <h3 class="slds-text-heading_medium">{!$Label.c.RD2_EnablementDisabledHeader}</h3>
                    <p class="slds-text-body_regular">{!$Label.c.RD2_EnablementDisabledMessage}</p>
                </div>
            </div>
        </lightning:layoutItem>
    </lightning:layout>


    <lightning:layout horizontalAlign="spread" multipleRows="true" class="slds-hide" aura:id="enabler">

        <lightning:layoutItem padding="horizontal-large" size="12">
            <lightning:formattedRichText class="slds-text-longform" value="{!$Label.c.RD2_EnablementIntro}" />
        </lightning:layoutItem>

        <lightning:layoutItem padding="horizontal-large" class="slds-p-top_large" size="12">
            <lightning:layout multipleRows="true">
                <h2 class="title slds-text-heading_small">{!$Label.c.RD2_EnablementPrepTitle}</h2>
                <lightning:layoutItem class="slds-p-top_small" size="12">
                    <lightning:formattedRichText class="slds-text-longform"
                        value="{!$Label.c.RD2_EnablementPrepIntro}" />
                </lightning:layoutItem>
                <lightning:layoutItem padding="horizontal-small" class="slds-p-top_small" size="12">
                    <lightning:formattedRichText class="slds-text-longform"
                        value="{!$Label.c.RD2_EnablementPrepTasks}" />
                </lightning:layoutItem>
            </lightning:layout>
        </lightning:layoutItem>

        <lightning:layoutItem padding="horizontal-small" class="slds-p-top_large" size="12">
            <lightning:card class="page-section" aura:id="enablement">

                <aura:set attribute="title">
                    <c:progressRing ringContent="1" valueNow="{!v.state.enableProgress}"
                        status="{!if(v.state.isEnabled, 'complete', '')}" class="slds-m-right_small" />
                    <lightning:formattedText value="{!$Label.c.RD2_EnablementEnableTitle}" />
                </aura:set>

                <div class="slds-setup-assistant__step-detail">
                    <div class="slds-progress slds-progress_vertical">
                        <ol class="slds-progress__list slds-progress__list-bordered">
                            <li
                                class="{!'slds-progress__item ' + if(v.state.isConfirmed, 'slds-is-completed', 'slds-is-active')}">

                                <c:progressIndicatorMarker isComplete="{!v.state.isConfirmed}" isPreviousComplete="true"
                                    isNextComplete="{!v.state.isEnabled}" />

                                <div class="slds-progress__item_content">
                                    <lightning:layout>
                                        <lightning:layoutItem size="10" class="slds-p-right_medium">
                                            <label for="enable-confirm">
                                                <lightning:formattedRichText
                                                    value="{!$Label.c.RD2_EnablementEnableConfirm}" />
                                            </label>
                                        </lightning:layoutItem>
                                        <lightning:layoutItem size="2">
                                            <lightning:input type="checkbox-button"
                                                label="{!$Label.c.RD2_EnablementEnableConfirm}" aura:id="enable-confirm"
                                                name="enable-confirm" checked="{!v.state.isConfirmed}"
                                                onchange="{!c.handleEnableConfirm}" />
                                        </lightning:layoutItem>
                                    </lightning:layout>
                                </div>
                            </li>

                            <li
                                class="{!'slds-progress__item ' + if(v.state.isEnabled, 'slds-is-completed', 'slds-is-active')}">

                                <c:progressIndicatorMarker isComplete="{!v.state.isEnabled}"
                                    isPreviousComplete="{!v.state.isConfirmed}"
                                    isNextComplete="{!v.state.isMetaDeployLaunched}" />

                                <div class="slds-progress__item_content">
                                    <lightning:layout>
                                        <lightning:layoutItem size="10" class="slds-p-right_medium">
                                            <div class="slds-media slds-media_center slds-text-align_center">
                                                <label for="enable-toggle">
                                                    <lightning:formattedRichText
                                                        value="{!$Label.c.RD2_EnablementEnableMessage}" />
                                                </label>
                                            </div>
                                        </lightning:layoutItem>
                                        <lightning:layoutItem size="2">
                                            <lightning:input type="toggle"
                                                label="{!$Label.c.RD2_EnablementEnableMessage}" variant="label-hidden"
                                                aura:id="enable-toggle" name="enable-toggle"
                                                checked="{!v.state.isEnabled}" onchange="{!c.handleEnable}"
                                                messageToggleActive="{!$Label.c.ToggleEnabled}"
                                                messageToggleInactive="{!$Label.c.ToggleDisabled}">
                                            </lightning:input>
                                        </lightning:layoutItem>
                                    </lightning:layout>
                                </div>
                            </li>
                        </ol>
                        <div aria-valuemin="0" aria-valuemax="100" aria-valuenow="{!v.state.enableProgress}"
                            role="progressbar">
                            <span class="slds-assistive-text">{!$Label.c.AlternativeTextProgress + ': ' +
                                v.state.enableProgress + '%'}</span>
                        </div>
                        <lightning:layout>
                            <lightning:layoutItem size="10" class="slds-p-right_medium">
                                <div class="slds-scoped-notification slds-media slds-media_center slds-scoped-notification_light"
                                    role="alert">
                                    <div class="slds-media__figure slds-text-align_center">
                                        <lightning:icon iconName="utility:warning"
                                            alternativeText="{!$Label.c.AlternativeTextWarning}" size="xx-small"
                                            variant="warning" />
                                    </div>
                                    <div class="slds-media__body">
                                        <lightning:formattedRichText value="{!$Label.c.RD2_EnablementEnableWarning}" />
                                    </div>
                                </div>
                            </lightning:layoutItem>
                        </lightning:layout>
                    </div>
                </div>
            </lightning:card>
        </lightning:layoutItem>


        <lightning:layoutItem padding="horizontal-small" size="12">
            <lightning:card class="page-section" aura:id="metadeploy">

                <aura:set attribute="title">
                    <c:progressRing ringContent="2" valueNow="{!v.state.metaDeployProgress}"
                        status="{!if(v.state.isMetaDeployConfirmed, 'complete', '')}" class="slds-m-right_small" />
                    <lightning:formattedText value="{!$Label.c.RD2_EnablementMetaDeployTitle}" />
                </aura:set>

                <div class="slds-setup-assistant__step-detail">
                    <div class="slds-progress slds-progress_vertical">
                        <ol class="slds-progress__list slds-progress__list-bordered">
                            <li
                                class="{!'slds-progress__item ' + if(v.state.isMetaDeployLaunched, 'slds-is-completed', 'slds-is-active')}">

                                <c:progressIndicatorMarker isComplete="{!v.state.isMetaDeployLaunched}"
                                    isPreviousComplete="{!v.state.isEnabled}"
                                    isNextComplete="{!v.state.isMetaDeployConfirmed}" />

                                <div class="slds-progress__item_content">
                                    <lightning:layout>
                                        <lightning:layoutItem size="10" class="slds-p-right_medium">
                                            <lightning:formattedRichText
                                                value="{!$Label.c.RD2_EnablementMetaDeployLaunch}" />
                                        </lightning:layoutItem>
                                        <lightning:layoutItem size="2">
                                            <a href="https://install.salesforce.org/products/npsp-rd2-pilot"
                                                aura:id="metadeploy-link" onclick="{!c.handleMetaDeployLaunch}"
                                                target=" _blank">{!$Label.c.RD2_EnablementMetaDeployLaunchLinkLabel}</a>
                                        </lightning:layoutItem>
                                    </lightning:layout>
                                </div>
                            </li>

                            <li
                                class="{!'slds-progress__item ' + if(v.state.isMetaDeployConfirmed, 'slds-is-completed', 'slds-is-active')}">

                                <c:progressIndicatorMarker isComplete="{!v.state.isMetaDeployConfirmed}"
                                    isPreviousComplete="{!v.state.isMetaDeployLaunched}"
                                    isNextComplete="{!v.state.isMigrationRun}" />

                                <div class="slds-progress__item_content">
                                    <lightning:layout>
                                        <lightning:layoutItem size="10" class="slds-p-right_medium">
                                            <label for="metadeploy-confirm">
                                                <lightning:formattedRichText
                                                    value="{!$Label.c.RD2_EnablementMetaDeployConfirm}" />
                                            </label>
                                        </lightning:layoutItem>
                                        <lightning:layoutItem size="2">
                                            <lightning:input type="checkbox-button"
                                                label="{!$Label.c.RD2_EnablementMetaDeployConfirm}"
                                                aura:id="metadeploy-confirm" name="metadeploy-confirm"
                                                checked="{!v.state.isMetaDeployConfirmed}"
                                                onchange="{!c.handleMetaDeployConfirm}" />
                                        </lightning:layoutItem>
                                    </lightning:layout>
                                </div>
                            </li>

                        </ol>
                        <div aria-valuemin="0" aria-valuemax="100" aria-valuenow="{!v.state.metaDeployProgress}"
                            role="progressbar">
                            <span class="slds-assistive-text">{!$Label.c.AlternativeTextProgress + ': ' +
                                v.state.metaDeployProgress + '%'}</span>
                        </div>
                    </div>
                </div>
            </lightning:card>
        </lightning:layoutItem>

        <lightning:layoutItem padding="horizontal-small" size="12">
            <lightning:card class="page-section" aura:id="migration">

                <aura:set attribute="title">
                    <c:progressRing ringContent="3" valueNow="{!if(v.state.isMigrationRun, '100', '0')}"
                        status="{!if(v.state.isMigrationRun, 'complete', '')}" class="slds-m-right_small" />
                    <lightning:formattedText value="{!$Label.c.RD2_EnablementMigrationTitle}" />
                </aura:set>

                <div class="slds-setup-assistant__step-detail">
                    <lightning:layout multipleRows="true">
                        <lightning:layoutItem size="10" class="slds-p-right_medium">
                            <lightning:formattedRichText value="{!$Label.c.RD2_EnablementMigrationRun}" />
                        </lightning:layoutItem>
                        <lightning:layoutItem size="2">
                            <lightning:button class="slds-m-left_x-small"
                                label="{!$Label.c.RD2_EnablementMigrationRunButton}" variant="neutral"
                                disabled="{!or(!v.state.isMetaDeployConfirmed, v.state.isMigrationRun)}" />
                        </lightning:layoutItem>
                        <lightning:layoutItem size="10" class="slds-p-right_medium">
                            <div class="slds-scoped-notification slds-media slds-media_center slds-scoped-notification_light slds-m-bottom_small"
                                role="alert">
                                <div class="slds-media__figure slds-text-align_center">
                                    <lightning:icon iconName="utility:warning"
                                        alternativeText="{!$Label.c.AlternativeTextWarning}" size="xx-small"
                                        variant="warning" />
                                </div>
                                <div class="slds-media__body">
                                    <lightning:formattedRichText value="{!$Label.c.RD2_EnablementMigrationWarning}" />
                                </div>
                            </div>
                        </lightning:layoutItem>
                        <lightning:layoutItem size="2" />
                    </lightning:layout>
                </div>
            </lightning:card>
        </lightning:layoutItem>
    </lightning:layout>

</aura:component>