<aura:component >
    <!-- public attributes -->
    <!-- note we kept our addresses typed as Object, to avoid namespace prefixing issues when we used Address__c -->
    <aura:attribute name="listAddr" type="Object[]" access="public"/>
    <aura:attribute name="addrDefault" type="Object" access="public" />

    <!-- private attributes -->
    <aura:attribute name="addrNew" type="Object" access="private"/>
    <aura:attribute name="showChangeAddressPopup" type="Boolean" access="private" />
    <aura:attribute name="iAddrSelected" type="Integer" default="0" access="private" />
    <aura:attribute name="isExistingAddrSectionOpen" type="Boolean" default="true" access="private" />
    
    <!-- events we handle -->
    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
    <aura:handler name="change" value="{!v.listAddr}" action="{!c.onChangeListAddr}" />

    <!-- events we fire -->
    <aura:registerEvent name="AddressChangedEvent" type="c:HH_AddressChangedEvent"/>
    
    <!-- markup follows... -->
    <div class="slds-grid slds-p-around_x-small">
        <div class="slds-card slds-p-around_none">
            <div class="slds-card__body slds-m-around_x-small slds-p-vertical_none" >
                <!-- address -->
                <div class="slds-text-body_small" >
                    <ui:outputText value="{!v.addrDefault.MailingStreet__c + 
                        (v.addrDefault.MailingStreet2__c != null ? '\n' + v.addrDefault.MailingStreet2__c : '')}" /><br/>
                    <ui:outputText value="{!v.addrDefault.MailingCity__c + (v.addrDefault.MailingState__c != null ? ', ' : '') + v.addrDefault.MailingState__c + ' ' + v.addrDefault.MailingPostalCode__c + ' '}" /><br/>
                    <ui:outputText value="{!v.addrDefault.MailingCountry__c}" />                                     
                </div>
            </div> 
            <div class="slds-card__footer">
                <div class="slds-grid slds-grid_align-center">
                    <ui:button class="slds-button slds-button_small slds-button_neutral" 
                               aura:id="btnChangeAddress" 
                               buttonTitle="{!$Label.npo02.ChangeAddress}" 
                               label="{!$Label.npo02.ChangeAddress}" 
                               press="{!c.openChangeAddress}" />
                </div>
            </div>
        </div> <!-- slds-card -->
    </div>    
    
    <!-- CHANGE ADDRESS POPUP -->
    <aura:if isTrue="{!v.showChangeAddressPopup}">
        <div id="changeAddressPopup" class="slds-modal slds-fade-in-open" aria-hidden="false" role="dialog">
            <div class="slds-modal__container">
                
                <div class="slds-modal__header">
                    <lightning:buttonIcon iconName="utility:close" class="slds-modal__close" variant="bare-inverse"
                        size="large" onclick="{!c.cancelChangeAddress}" alternativeText="{!$Label.c.bdiBtnClose}" />
                    <h2 id="searchPopupLabel" class="slds-text-heading_medium">{!$Label.npo02.ChangeAddress}</h2>
                </div>
                <div class="slds-modal__content slds-p-around_medium">
                    <lightning:accordion aura:id="addressSelectionAccordion" activeSectionName="A">
                        <lightning:accordionSection name="{!$Label.npo02.SelectExistingAddress}" label="{!$Label.npo02.SelectExistingAddress}">
                            <ul class="slds-list_vertical slds-has-dividers_around-space slds-has-list-interactions" >
                                <aura:iteration items="{!v.listAddr}" var="addr" indexVar="iAddr" > 
                                <li>
                                    <lightning:button class="{!iAddr == v.iAddrSelected ? 'selected-address address-button' : 'address-button'}" 
                                         onclick="{!c.onPressAddrTile}" value="{!iAddr}" ariaDescribedBy="existingAdd">
                                        <div class="slds-tile slds-tile_board">
                                            <div class="slds-tile__detail" >
                                                <!-- address -->
                                                <p class="slds-text-body_small slds-text-color_default address-text" id="existingAdd">
                                                    {!addr.MailingStreet__c + (addr.MailingStreet2__c != null ? '\n' + addr.MailingStreet2__c : '')}
                                                    <br/>
                                                    {!addr.MailingCity__c + (addr.MailingState__c != null ? ', ' : '') + addr.MailingState__c + ' ' + addr.MailingPostalCode__c + ' '}
                                                    <br/>
                                                    {!addr.MailingCountry__c}
                                                </p>
                                            </div> 
                                        </div>
                                    </lightning:button>
                                    </li>
                                </aura:iteration>
                            </ul>
                        </lightning:accordionSection>
                        <lightning:accordionSection name="{!$Label.npo02.EnterNewAddress}" label="{!$Label.npo02.EnterNewAddress}">
                                <div class="slds-form_stacked">
                                    <div class="slds-form-element">
                                        <ui:inputTextArea value="{!v.addrNew.MailingStreet__c}" aura:id="txtStreet" class="slds-input slds-form-element__control" 
                                            label="{!$Label.c.lblStreet}" labelClass="slds-form-element__label" />
                                    </div>
                                    <div class="slds-form-element">
                                        <ui:inputText value="{!v.addrNew.MailingCity__c}" aura:id="txtCity" class="slds-input slds-form-element__control" 
                                            label="{!$Label.c.lblCity}" labelClass="slds-form-element__label" />
                                    </div>
                                    <div class="slds-form-element">
                                        <ui:inputText value="{!v.addrNew.MailingState__c}" aura:id="txtState" class="slds-input slds-form-element__control" 
                                            label="{!$Label.c.lblState}" labelClass="slds-form-element__label" />
                                    </div>
                                    <div class="slds-form-element">
                                        <ui:inputText value="{!v.addrNew.MailingPostalCode__c}" aura:id="txtZip" class="slds-input slds-form-element__control" 
                                            label="{!$Label.c.lblPostalCode}" labelClass="slds-form-element__label" />
                                    </div>
                                    <div class="slds-form-element">
                                        <ui:inputText value="{!v.addrNew.MailingCountry__c}" aura:id="txtCountry" class="slds-input slds-form-element__control" 
                                            label="{!$Label.c.lblCountry}" labelClass="slds-form-element__label" />
                                    </div>
                                </div>
                        </lightning:accordionSection>

                    </lightning:accordion>


                   
                </div> <!-- /slds-modal__content -->
                
                <div class="slds-modal__footer">
                    <div class="slds-x-small-buttons_horizontal">
                        <lightning:button
                                   aura:id="btnCancelChangeAddress"
                                   title="{!$Label.c.stgBtnCancel}" 
                                   label="{!$Label.c.stgBtnCancel}" 
                                   onclick="{!c.cancelChangeAddress}" />
                        <lightning:button
                                    variant="brand"
                                   aura:id="btnSaveChangeAddress"
                                   title="{!$Label.npo02.SetAddress}" 
                                   label="{!$Label.npo02.SetAddress}" 
                                   onclick="{!c.saveChangeAddress}" />
                    </div>
                </div>
            </div> <!-- /slds-modal__container -->
        </div> <!-- /slds-modal -->
        <div class="slds-backdrop slds-backdrop_open"></div>
    </aura:if>
    <!-- /DELETE CONTACT POPUP -->
    
</aura:component>